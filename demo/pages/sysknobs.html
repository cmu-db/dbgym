<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Step 2/3: System Knobs</title>
    <link rel="stylesheet" type="text/css" href="../css/style.css">
    <style>
        #sysknobsTable {
            padding: 20px;
        }
    </style>
</head>

<body>
    <div class="header-bar">
        <h1>Step 2/3: System-Wide Knobs</h1>
        <button class="next-button" onclick="saveAndMoveToQueryKnobs()">Query Knobs â†’</button>
    </div>

    <div class="container">
        <div class="actionsContainer">
            <table id="sysknobsTable">
                <thead>
                    <tr>
                        <th>Knob</th>
                        <th>Default</th>
                        <th>Current</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>shared_buffers</td>
                        <td>128MB</td>
                        <td><select id="shared_buffers">
                            <option value="64MB">64MB</option>
                            <option value="128MB" selected>128MB</option>
                            <option value="256MB">256MB</option>
                        </select></td>
                    </tr>
                    <tr>
                        <td>checkpoint_segments</td>
                        <td>3</td>
                        <td><select id="checkpoint_segments">
                            <option value="3" selected>3</option>
                            <option value="9">9</option>
                            <option value="27">27</option>
                        </select></td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div id="queriesContainer">
            <script src="../js/loadPopupHtml.js"></script>
            <script>
                fetch('../components/queries.html')
                    .then(response => response.text())
                    .then(data => {
                        document.getElementById('queriesContainer').innerHTML = data;
                    })
                    .then(data => {
                        initializePopup();
                    })
                    .catch(error => console.error("Error loading popup:", error));
            </script>
        </div>
    </div>

    <img id="cmu-db-logo" src="../assets/cmu-db-logo.svg" alt="CMU DB Logo">

    <div id="printJsonButtonContainer">
        <script>
            fetch('../components/printJsonButton.html')
                .then(response => response.text())
                .then(data => {
                    document.getElementById('printJsonButtonContainer').innerHTML = data;
                })
                .catch(error => console.error("Error loading popup:", error));
        </script>
    </div>

    <script>
        function saveAndMoveToQueryKnobs() {
            // Retrieve existing userData from local storage
            const userData = JSON.parse(localStorage.getItem('userData')) || {};

            // Initialize sysknobs dictionary
            const sysknobs = {};

            // Get current values from the dropdowns
            sysknobs.shared_buffers = document.getElementById('shared_buffers').value; // Get value of shared_buffers
            sysknobs.checkpoint_segments = document.getElementById('checkpoint_segments').value; // Get value of checkpoint_segments

            // Update userData with sysknobs
            userData.sysknobs = sysknobs;

            // Save updated userData back to local storage
            localStorage.setItem('userData', JSON.stringify(userData));

            console.log(userData); // For demonstration, log the userData

            // Redirect to the queryKnobs page
            window.location.href = 'qknobs.html';
        }
    </script>
</body>