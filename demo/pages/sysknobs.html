<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Step 2/3: System Knobs</title>
    <link rel="stylesheet" type="text/css" href="../css/style.css">
    <style>
        #sysknobsTable {
            padding: 20px;
        }
    </style>
</head>

<body>
    <div class="header-bar">
        <h1>Step 2/3: System-Wide Knobs</h1>
        <div id="timerDisplay"></div>
        <button class="next-button" onclick="saveToUserData(); window.location.href='qknobs.html';">Query Knobs â†’</button>
    </div>

    <div class="container">
        <div class="actionsContainer">
            <table id="sysknobsTable">
                <thead>
                    <tr>
                        <th>Knob</th>
                        <th>Default</th>
                        <th>Current</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>shared_buffers</td>
                        <td>128MB</td>
                        <td><select id="shared_buffers">
                            <option value="64MB">64MB</option>
                            <option value="128MB" selected>128MB</option>
                            <option value="256MB">256MB</option>
                            <option value="512MB">512MB</option>
                            <option value="1GB">1GB</option>
                        </select></td>
                    </tr>
                    <tr>
                        <td>effective_cache_size</td>
                        <td>4GB</td>
                        <td><select id="effective_cache_size">
                            <option value="2GB">2GB</option>
                            <option value="4GB" selected>4GB</option>
                            <option value="8GB">8GB</option>
                            <option value="16GB">16GB</option>
                            <option value="32GB">32GB</option>
                        </select></td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div id="queriesContainer">
            <script src="../js/queriesScripts.js"></script>
            <script>
                fetch('../components/queries.html')
                    .then(response => response.text())
                    .then(data => {
                        document.getElementById('queriesContainer').innerHTML = data;
                    })
                    .then(data => {
                        initializePopup();
                        initializeAccordion();
                    })
                    .catch(error => console.error("Error loading popup:", error));
            </script>
        </div>
    </div>

    <img id="cmu-db-logo" src="../assets/cmu-db-logo.svg" alt="CMU DB Logo">

    <div id="printJsonButtonContainer">
        <script>
            fetch('../components/printJsonButton.html')
                .then(response => response.text())
                .then(data => {
                    document.getElementById('printJsonButtonContainer').innerHTML = data;
                })
                .catch(error => console.error("Error loading popup:", error));
        </script>
    </div>

    <script src="../js/timer.js"></script>

    <div id="timesUpPopupContainer">
        <script>
            fetch('../components/timesUpPopup.html')
                .then(response => response.text())
                .then(data => {
                    document.getElementById('timesUpPopupContainer').innerHTML = data;
                })
                .then(data => {
                    // timer.js calls setText() but it might call it before the popup is loaded.
                    const startTime = localStorage.getItem('startTime');
                    setText(startTime);
                })
                .catch(error => console.error("Error loading popup:", error));
        </script>
    </div>

    <script>
        // The times up popup will call this function when the user clicks submit so you must name it this.
        function saveToUserData() {
            // Retrieve existing userData from local storage
            const userData = JSON.parse(localStorage.getItem('userData')) || {};

            // Initialize sysknobs dictionary
            const sysknobs = {};

            // Get current values from the dropdowns
            sysknobs.shared_buffers = document.getElementById('shared_buffers').value; // Get value of shared_buffers
            sysknobs.effective_cache_size = document.getElementById('effective_cache_size').value; // Get value of effective_cache_size

            // Update userData with sysknobs
            userData.sysknobs = sysknobs;

            // Save updated userData back to local storage
            localStorage.setItem('userData', JSON.stringify(userData));
        }
    </script>
</body>