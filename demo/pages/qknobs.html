<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Step 3/3: Query Knobs</title>
    <link rel="stylesheet" type="text/css" href="../css/style.css">
    <style>
        #qknobsTable {
            padding: 20px;
        }
    </style>
</head>

<body>
    <div class="header-bar">
        <h1>Step 3/3: Per-Query Knobs</h1>
        <div id="timerDisplay"></div>
        <button class="next-button" onclick="saveToUserData(); window.location.href='submission.html';">Submit â†’</button>
    </div>

    <div class="container">
        <div class="actionsContainer">
            <table id="qknobsTable">
                <thead>
                    <tr>
                        <th>Knob</th>
                        <th>Default</th>
                        <th>Q1</th>
                        <th>Q2</th>
                        <th>Q3</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>enable_nestloop</td>
                        <td>ON</td>
                        <td>
                            <select id="enable_nestloop_q1">
                                <option value="ON" selected>ON</option>
                                <option value="OFF">OFF</option>
                            </select>
                        </td>
                        <td>
                            <select id="enable_nestloop_q2">
                                <option value="ON" selected>ON</option>
                                <option value="OFF">OFF</option>
                            </select>
                        </td>
                        <td>
                            <select id="enable_nestloop_q3">
                                <option value="ON" selected>ON</option>
                                <option value="OFF">OFF</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td>enable_hashjoin</td>
                        <td>ON</td>
                        <td>
                            <select id="enable_hashjoin_q1">
                                <option value="ON" selected>ON</option>
                                <option value="OFF">OFF</option>
                            </select>
                        </td>
                        <td>
                            <select id="enable_hashjoin_q2">
                                <option value="ON" selected>ON</option>
                                <option value="OFF">OFF</option>
                            </select>
                        </td>
                        <td>
                            <select id="enable_hashjoin_q3">
                                <option value="ON" selected>ON</option>
                                <option value="OFF">OFF</option>
                            </select>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div id="queriesContainer">
            <script src="../js/queriesScripts.js"></script>
            <script>
                fetch('../components/queries.html')
                    .then(response => response.text())
                    .then(data => {
                        document.getElementById('queriesContainer').innerHTML = data;
                    })
                    .then(data => {
                        initializePopup();
                        initializeAccordion();
                    })
                    .catch(error => console.error("Error loading popup:", error));
            </script>
        </div>
    </div>

    <img id="cmu-db-logo" src="../assets/cmu-db-logo.svg" alt="CMU DB Logo">

    <div id="printJsonButtonContainer">
        <script>
            fetch('../components/printJsonButton.html')
                .then(response => response.text())
                .then(data => {
                    document.getElementById('printJsonButtonContainer').innerHTML = data;
                })
                .catch(error => console.error("Error loading popup:", error));
        </script>
    </div>

    <script src="../js/timer.js"></script>

    <div id="timesUpPopupContainer">
        <script>
            fetch('../components/timesUpPopup.html')
                .then(response => response.text())
                .then(data => {
                    document.getElementById('timesUpPopupContainer').innerHTML = data;
                })
                .then(data => {
                    // timer.js calls setText() but it might call it before the popup is loaded.
                    const startTime = localStorage.getItem('startTime');
                    setText(startTime);
                })
                .catch(error => console.error("Error loading popup:", error));
        </script>
    </div>

    <script>
        function saveToUserData() {
            // Retrieve existing userData from local storage
            const userData = JSON.parse(localStorage.getItem('userData')) || {};

            // Initialize qknobs dictionary
            const qknobs = {};
            qknobs.q1 = [];
            qknobs.q2 = [];
            qknobs.q3 = [];

            // Get current values from the dropdowns
            // TODO

            // Update userData with qknobs
            userData.qknobs = qknobs;

            // Save updated userData back to local storage
            localStorage.setItem('userData', JSON.stringify(userData));
        }
    </script>
</body>