<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Step 3/3: Query Knobs</title>
    <link rel="stylesheet" type="text/css" href="../css/style.css">
    <style>
        #qknobsTable {
            padding: 20px;
        }
    </style>
</head>

<body>
    <div class="header-bar">
        <h1>Step 3/3: Per-Query Knobs</h1>
        <button class="next-button" onclick="saveAndMoveToLeaderboard()">Submit â†’</button>
    </div>

    <div class="container">
        <div class="actionsContainer">
            <table id="qknobsTable">
                <thead>
                    <tr>
                        <th>Knob</th>
                        <th>Default</th>
                        <th>Q1</th>
                        <th>Q2</th>
                        <th>Q3</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>enable_nestloop</td>
                        <td>ON</td>
                        <td>
                            <select id="enable_nestloop_q1">
                                <option value="ON" selected>ON</option>
                                <option value="OFF">OFF</option>
                            </select>
                        </td>
                        <td>
                            <select id="enable_nestloop_q2">
                                <option value="ON" selected>ON</option>
                                <option value="OFF">OFF</option>
                            </select>
                        </td>
                        <td>
                            <select id="enable_nestloop_q3">
                                <option value="ON" selected>ON</option>
                                <option value="OFF">OFF</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td>enable_hashjoin</td>
                        <td>ON</td>
                        <td>
                            <select id="enable_hashjoin_q1">
                                <option value="ON" selected>ON</option>
                                <option value="OFF">OFF</option>
                            </select>
                        </td>
                        <td>
                            <select id="enable_hashjoin_q2">
                                <option value="ON" selected>ON</option>
                                <option value="OFF">OFF</option>
                            </select>
                        </td>
                        <td>
                            <select id="enable_hashjoin_q3">
                                <option value="ON" selected>ON</option>
                                <option value="OFF">OFF</option>
                            </select>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div id="queriesContainer">
            <script src="../js/loadPopupHtml.js"></script>
            <script>
                fetch('../components/queries.html')
                    .then(response => response.text())
                    .then(data => {
                        document.getElementById('queriesContainer').innerHTML = data;
                    })
                    .then(data => {
                        initializePopup();
                    })
                    .catch(error => console.error("Error loading popup:", error));
            </script>
        </div>
    </div>

    <img id="cmu-db-logo" src="../assets/cmu-db-logo.svg" alt="CMU DB Logo">

    <div id="printJsonButtonContainer">
        <script>
            fetch('../components/printJsonButton.html')
                .then(response => response.text())
                .then(data => {
                    document.getElementById('printJsonButtonContainer').innerHTML = data;
                })
                .catch(error => console.error("Error loading popup:", error));
        </script>
    </div>

    <script>
        function saveAndMoveToLeaderboard() {
            // Retrieve existing userData from local storage
            const userData = JSON.parse(localStorage.getItem('userData')) || {};

            // Initialize qknobs dictionary
            const qknobs = {};
            qknobs.enable_nestloop = {};
            qknobs.enable_hashjoin = {};

            // Get current values from the dropdowns
            qknobs.enable_nestloop.q1 = document.getElementById('enable_nestloop_q1').value;
            qknobs.enable_nestloop.q2 = document.getElementById('enable_nestloop_q2').value;
            qknobs.enable_nestloop.q3 = document.getElementById('enable_nestloop_q3').value;
            qknobs.enable_hashjoin.q1 = document.getElementById('enable_hashjoin_q1').value;
            qknobs.enable_hashjoin.q2 = document.getElementById('enable_hashjoin_q2').value;
            qknobs.enable_hashjoin.q3 = document.getElementById('enable_hashjoin_q3').value;

            // Update userData with qknobs
            userData.qknobs = qknobs;

            // Save updated userData back to local storage
            localStorage.setItem('userData', JSON.stringify(userData));

            console.log(userData); // For demonstration, log the userData

            // Redirect to the leaderboard page
            window.location.href = 'leaderboard.html';
        }
    </script>
</body>